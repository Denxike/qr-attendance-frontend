import{u as D,j as e}from"./index-DpS5W-O8.js";import{r as n}from"./vendor-BCPqKLS0.js";import{t as x}from"./api-BtkNoZFK.js";import{N as E}from"./Navbar-CRxTdA3d.js";import{B as p,f as k,A as L,g as G,Q as T}from"./icons-DPHu3S6L.js";const W=()=>{const{user:c}=D();console.log(c);const[u,A]=n.useState([]),[i,S]=n.useState(null),[a,l]=n.useState(null),[h,j]=n.useState([]),[w,g]=n.useState(!0),[f,y]=n.useState(!1),[b,v]=n.useState(null),[d,m]=n.useState({sessionName:"",durationMinutes:5}),C=n.useCallback(async()=>{g(!0);try{const s=c.teacherId||c.userId,t=await x.getCourses(s);A(t.data)}catch(s){console.error("Failed to load courses:",s)}finally{g(!1)}},[c.teacherId,c.userId]),I=n.useCallback(async s=>{try{const t=await x.getSessionAttendance(s);j(t.data),l(o=>({...o,totalScans:t.data.length}))}catch(t){console.error("Failed to fetch attendance:",t)}},[]);n.useEffect(()=>{C()},[C]),n.useEffect(()=>{if(!a)return;const s=setInterval(()=>{const t=new Date(a.expiryTime),r=Math.floor((t-new Date)/1e3);if(r<=0)v("Expired"),l(N=>({...N,isActive:!1})),clearInterval(s);else{const N=Math.floor(r/60),M=r%60;v(`${N}:${M.toString().padStart(2,"0")}`)}},1e3);return()=>clearInterval(s)},[a==null?void 0:a.expiryTime]),n.useEffect(()=>{if(!(a!=null&&a.isActive))return;const s=setInterval(()=>{I(a.sessionId)},5e3);return()=>clearInterval(s)},[a==null?void 0:a.isActive,a==null?void 0:a.sessionId,I]);const q=async s=>{var t,o;if(s.preventDefault(),!!i){y(!0);try{const r=await x.generateQR({courseId:i.id,sessionName:d.sessionName,durationMinutes:parseInt(d.durationMinutes)});l(r.data),j([]),m({sessionName:"",durationMinutes:5,location:""})}catch(r){alert(((o=(t=r.response)==null?void 0:t.data)==null?void 0:o.message)||"Failed to generate QR code")}finally{y(!1)}}},Q=async()=>{if(a)try{await x.deactivateSession(a.sessionId),l(s=>({...s,isActive:!1})),v("Ended")}catch{alert("Failed to deactivate session")}},R=s=>{S(s),l(null),j([])};return e.jsxs("div",{className:"dashboard",children:[e.jsx(E,{}),e.jsxs("div",{className:"dashboard-content",children:[e.jsxs("div",{className:"dashboard-welcome",children:[e.jsx("h2",{children:"Teacher Dashboard "}),e.jsx("p",{children:"Generate QR codes and track student attendance"})]}),e.jsxs("div",{className:"stats-row",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon blue",children:e.jsx(p,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:u.length}),e.jsx("div",{className:"stat-label",children:"My Courses"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon green",children:e.jsx(k,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:(a==null?void 0:a.totalScans)||0}),e.jsx("div",{className:"stat-label",children:"Students Scanned"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon purple",children:e.jsx(L,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:a!=null&&a.isActive?"Active":"None"}),e.jsx("div",{className:"stat-label",children:"Active Session"})]})]})]}),e.jsxs("div",{className:"two-col",children:[e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-header",children:e.jsxs("h3",{children:[e.jsx(p,{})," My Courses"]})}),e.jsx("div",{className:"section-body",children:w?e.jsx("div",{className:"loading-spinner",children:"Loading..."}):u.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:e.jsx(p,{})}),e.jsx("p",{children:"No courses assigned"})]}):e.jsx("div",{className:"courses-list",children:u.map(s=>e.jsx("div",{className:`course-item ${(i==null?void 0:i.id)===s.id?"active":""}`,onClick:()=>R(s),children:e.jsxs("div",{className:"course-item-left",children:[e.jsx("span",{className:"course-badge",children:s.courseCode}),e.jsx("div",{children:e.jsx("div",{className:"course-item-name",children:s.courseName})})]})},s.id))})})]}),e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-header",children:e.jsx("h3",{children:a!=null&&a.isActive?e.jsxs("p",{style:{display:"flex",alignItems:"center",gap:".5rem"},children:[e.jsx(G,{}),"Active Session"]}):e.jsxs("p",{style:{display:"flex",alignItems:"center",gap:".5rem"},children:[e.jsx(T,{}),"Generate QR Code"]})})}),e.jsx("div",{className:"section-body",children:a!=null&&a.isActive?e.jsxs("div",{className:"qr-display",children:[e.jsx("img",{src:`data:image/png;base64,${a.qrCodeImage}`,alt:"QR Code",className:"qr-image"}),e.jsxs("div",{className:"qr-info",children:[e.jsx("div",{className:"qr-course",children:a.courseName}),e.jsx("div",{className:"qr-session",children:a.sessionName})]}),e.jsxs("div",{className:`qr-timer ${b==="Expired"?"expired":""}`,children:["â± ",b||"Loading..."]}),e.jsxs("div",{className:"qr-scans",children:[e.jsx("span",{children:h.length})," students scanned"]}),e.jsx("button",{className:"btn-deactivate",onClick:Q,children:"End Session"})]}):i?e.jsxs("form",{className:"generate-form",onSubmit:q,children:[e.jsxs("p",{style:{marginBottom:"16px",color:"#666",fontSize:"14px"},children:["Generating for: ",e.jsxs("strong",{children:[i.courseCode," - ",i.courseName]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Session Name"}),e.jsx("input",{type:"text",placeholder:"e.g. Week 5 Lecture",value:d.sessionName,onChange:s=>m(t=>({...t,sessionName:s.target.value})),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Duration"}),e.jsxs("select",{value:d.durationMinutes,onChange:s=>m(t=>({...t,durationMinutes:s.target.value})),children:[e.jsx("option",{value:"5",children:"5 minutes"}),e.jsx("option",{value:"10",children:"10 minutes"}),e.jsx("option",{value:"15",children:"15 minutes"}),e.jsx("option",{value:"30",children:"30 minutes"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Location (Optional)"}),e.jsx("input",{type:"text",placeholder:"e.g. Room 301",value:d.location,onChange:s=>m(t=>({...t,location:s.target.value}))})]}),e.jsx("button",{type:"submit",className:"btn-create-qr",disabled:f,children:f?"Generating...":"ðŸ”² Generate QR Code"})]}):e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ‘ˆ"}),e.jsx("p",{children:"Select a course to generate QR"})]})})]})]}),a&&h.length>0&&e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"âœ… Students Who Scanned"}),e.jsxs("span",{style:{fontSize:"14px",color:"#666"},children:[h.length," students"]})]}),e.jsx("div",{className:"section-body",style:{padding:0},children:e.jsxs("table",{className:"attendance-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Student ID"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Time"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:h.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:t+1}),e.jsx("td",{children:s.studentRegistrationId}),e.jsx("td",{children:s.studentName}),e.jsx("td",{children:new Date(s.markedAt).toLocaleTimeString()}),e.jsx("td",{children:e.jsx("span",{className:`status-badge status-${s.status}`,children:s.status})})]},s.id))})]})})]})]})]})};export{W as default};
